!function(){var n,o;n="http://www.w3.org/2000/svg",(o=function(t){return this.root="string"==typeof(t=null==t?{}:t).root?document.querySelector(t.root):t.root,this.evtHandler={},this.lc={},this.type=t.type,this.popup=t.popup,this.baseurl=t.baseurl,this.padding=t.padding,this}).register=function(t,e){return(o._data||(o._data={}))[t]=e},o.get=function(t){return Promise.resolve(o._data[t])},o.prototype=function(t,e){var n,r={}.hasOwnProperty;for(n in e)r.call(e,n)&&(t[n]=e[n]);return t}(Object.create(Object.prototype),{on:function(t,n){var r=this;return(Array.isArray(t)?t:[t]).map(function(t){var e;return((e=r.evtHandler)[t]||(e[t]=[])).push(n)})},fire:function(t){for(var e,n,r,o,i=[],a=[],s=1,p=arguments.length;s<p;++s)a.push(arguments[s]);for(e=a,s=0,r=(n=this.evtHandler[t]||[]).length;s<r;++s)o=n[s],i.push(o.apply(this,e));return i},init:function(){var r=this,t=this.root,e=this.type;this.popup;return this.svg="svg"===t.nodeName.toLowerCase()?t:ld$.parent(t,"svg"),this.svg||(t.appendChild(this.svg=document.createElementNS(n,"svg")),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%")),"g"===t.nodeName.toLowerCase()?this.node=t:this.node=this.svg,this.node.appendChild(this.g=document.createElementNS(n,"g")),this.svg.addEventListener("mousemove",function(t){var e,n;if((e=t.target)&&1===e.nodeType&&(n=d3.select(e).datum()))return r.fire("hover",{evt:t,data:n})}),o.get(e).then(function(t){var e=t.topo,n=t.meta,t=r.lc;return t.topo=e,t.meta=n,r.lc.features=e=topojson.feature(r.lc.topo,r.lc.topo.objects.pdmaptw).features,e.map(function(t){var e=[n.name[t.properties.c],n.name[t.properties.t],n.name[t.properties.v]].filter(function(t){return t}).join("");return t.properties.name=o.normalize(e)}),r.lc.path=t=d3.geoPath().projection(o.projection()),d3.select(r.g).attr("class","pdmaptw").selectAll("path").data(e).enter().append("path").attr("d",t)})},scale:function(){return this._scale||1},fit:function(t){var e,n=(t=null==t?{}:t).box||(this.node.getBoundingClientRect?this.node.getBoundingClientRect():this.node.getBBox()),r=this.g.getBBox(),o=(e=[n.width,n.height])[0],t=e[1],n=null!=this.padding?this.padding:20;return this._scale=n=Math.min((o-2*n)/r.width,(t-2*n)/r.height),this.g.setAttribute("transform","translate("+(e=[o/2,t/2])[0]+","+e[1]+") scale("+n+") translate("+(-r.x-r.width/2)+","+(-r.y-r.height/2)+")")}}),o.projection=function(){var t;return(t=o._projection)?t:o._projection=d3.geoProjection(function(t,e){var n=180*e/Math.PI,r=180*t/Math.PI;return 123<r&&25.7<n?(r-=1.5,n-=.5):n<23.82&&r<119.9?r+=.2:25.7<n&&r<122?n-=1.1:r<119.4?r+=1.5:25.4<n&&122<r&&--n,(n=25.819<n?25.819:n)<21.798&&(n=21.798),[t=(r=122.3<(r=r<119.369?119.369:r)?122.3:r)*Math.PI/180,e=n*Math.PI/180]})},o.normalize=function(t){return t.replace(/臺/g,"台")},"undefined"!=typeof module&&null!==module?module.exports=o:"undefined"!=typeof window&&null!==window&&(window.pdmaptw=o)}.call(this);
